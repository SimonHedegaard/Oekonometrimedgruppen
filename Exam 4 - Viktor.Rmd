---
title: "Exam 4 - Viktor"
author: "Viktor Damm"
date: "2024-05-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
rm(list=ls())
```

```{r}
library(readr)
library(AER)
library(foreign)
library(car)
library(sandwich)
library(texreg)
data4 <- read_csv("data4.csv")
participation <- data4$participation
income <- data4$income
age <- data4$age
agesq <- data4$agesq
educ <- data4$educ
youngkids <- data4$youngkids
oldkids <- data4$oldkids
foreign <- data4$foreign
n <- nrow(data4)
```

#1.Opstil en lineær regressionsmodel for participation, hvor du bruger de beskrevne forklarende variable.

$$participation = \beta_0 + \beta_1*income + \beta_2*age + \beta_3*agesq + \beta_4*educ + \beta_5*youngkids + \beta_6*oldkids + \beta_7*foreign$$
##(a) Estimer modellen vha. OLS og kommenter på resultaterne.

First, we are going to estimate the model, using a OLS regression. This is done with the following code: 
```{r}
ols <- lm(participation ~ income + age + agesq + educ + youngkids + oldkids + foreign)
summary(ols)
```

##(b) Test om den partielle effekt af uddannelse er forskellig fra nul.

```{r}
df <- summary(ols)$df[2]
t_stat<-0.0067725/0.0059615
t_stat
c<-qt(1-0.05, n-1)
c
p_value <- 2*pt(-abs(t_stat), df)
p_value
```

##(c) Test om den partielle effekt af alder er forskellig fra nul.

```{r}
t_stat2<-0.0633852/0.0128603
t_stat2
c<-qt(1-0.05, n-1)
c
p_value2 <- 2*pt(-abs(t_stat2), df)
p_value2
```

#2. Opstil både en logit- og en probit-model for participation hvor du bruger de beskrevne forklarende variable.

##(a) Estimer modellerne.

The models are being estimated, using the following code:
```{r}
logit <- glm(participation ~ income + age + agesq + educ + youngkids + oldkids + foreign,
family = binomial(link = "logit"))
probit <- glm(participation ~ income + age + agesq + educ + youngkids + oldkids + foreign,
family = binomial(link = "probit"))
screenreg(list( Logit = logit, Probit = probit), digits = 4)
```

##(b) Test om den partielle effekt af uddannelse er forskellig fra nul.

For the logic model:
```{r}
t_stat_logit <- 0.0386/0.0302
t_stat_logit
c<-qt(1-0.05, n-1)
c
p_value_logit <- 2*pt(-abs(t_stat_logit), df)
p_value_logit
```

For the probit model: 
```{r}
t_stat_probit <- 0.0231/0.0181
t_stat_probit
c<-qt(1-0.05, n-1)
c
p_value_probit <- 2*pt(-abs(t_stat_probit), df)
p_value_probit
```

##(c) Test om den partielle effekt af alder er forskellig fra nul vha. et likelihoodratio-test.

The logit model:
```{r}
## Pseudo R^2
logitR <- glm(participation ~ income + educ + youngkids + oldkids + foreign,
family = binomial(link = "logit"))
lr_logit <- 2 * (logLik(logit) - logLik(logitR))
lr_logit # The df are not true - these are really 2
pval_logit <- pchisq(lr_logit, df = 2, lower.tail = F)
pval_logit # Suggests surely that we must reject H_0 (as expected)
```

The probit model:
```{r}
## Pseudo R^2
probitR <- glm(participation ~ income + educ + youngkids + oldkids + foreign,
family = binomial(link = "probit"))
lr_probit <- 2 * (logLik(probit) - logLik(probitR))
lr_probit # The df are not true - these are really 2
pval_probit <- pchisq(lr_probit, df = 2, lower.tail = F)
pval_probit # Suggests surely that we must reject H_0 (as expected)
```

#3. Vi vil gerne sammenligne den partielle effekt af income på tværs af modellerne. Beregn average partial effect (APE) og kommenter på resultaterne.

```{r}
library(mfx)
## Average Partial Effect - logit
ape_logit <- logitmfx(logit, data = data4, atmean = F)
## Average Partial Effect - probit
ape_probit <- probitmfx(probit, data = data4, atmean = F)
screenreg(list(OLS = ols, Logit_APE = ape_logit, Probit_APE = ape_probit), digits = 4)
```

#4. Vi vil gerne sammenligne den partielle effekt af f or ei g n på tværs af modellerne. Beregn APE og kommenter på resultaterne.

```{r}
cdata <- cbind(1, as.matrix(data4[, c("income", "age", "agesq", "educ",
"youngkids", "oldkids", "foreign")]))
cdata1 <- cdata
cdata1[, 8] <- 1
cdata2 <- cdata
cdata2[, 8] <- 0
pcoef <- probit$coefficients
mean(pnorm(cdata1 %*% pcoef) - pnorm(cdata2 %*% pcoef))
```

#5. Hvorfor er APE at foretrække frem for partial effect at the average (PEA)?

#6. Sammenlign modellernes evne til at prædiktere ved at beregne percent correctly predicted for hver model.

```{r}
## Percently Correctly Predicted
y <- data4["participation"]
olspred <- 100 * mean((ols$fitted > 0.5) == y)
logitpred <- 100 * mean((logit$fitted > 0.5) == y)
probitpred <- 100 * mean((probit$fitted > 0.5) == y)
print(c(olspred, logitpred, probitpred))
```




